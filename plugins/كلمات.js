/**
 * ๐ง *ูุณุงุนุฏ ุจูุช ูุฌูุจ ูููุงุช ุงูุฃุบุงูู* ๐ง
 * ๐ ุงููุตุฏุฑ: https://whatsapp.com/channel/0029Vb6CZ5AJpe8nf31dSp3A
 * โ๏ธ ุชู ุงูุชุนุฏูู ุจูุงุณุทุฉ: ๐๐ธ๐๐พ ๐ฑ๐พ๐๐ง
 */

import cheerio from "cheerio";

async function ุฌูุจ_ูููุงุช(ุงูุฃุบููุฉ) {
    try {
        const response = await fetch(`https://r.jina.ai/https://www.google.com/search?q=ูููุงุช+ุงุบููุฉ+${encodeURIComponent(ุงูุฃุบููุฉ)}&hl=ar`, {
            headers: {
                'x-return-format': 'html',
                'x-engine': 'cf-browser-rendering',
            }
        });

        const text = await response.text();
        const $ = cheerio.load(text);
        const ูููุงุช = [];
        const ุจูุงูุงุช = [];
        const ุงููุชูุฌุฉ = {};

        // ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ
        $('div.PZPZlf').each((i, e) => {
            const ุจูุงูุงุช_ููุชุดูุฉ = $(e).find('div[jsname="U8S5sf"]').text().trim();
            if (!ุจูุงูุงุช_ููุชุดูุฉ) ุจูุงูุงุช.push($(e).text().trim());
        });

        // ุงุณุชุฎุฑุงุฌ ูููุงุช ุงูุฃุบููุฉ
        $('div[jsname="U8S5sf"]').each((i, el) => {
            let ุณุทูุฑ = '';
            $(el).find('span[jsname="YS01Ge"]').each((j, span) => {
                ุณุทูุฑ += $(span).text() + '\n';
            });
            ูููุงุช.push(ุณุทูุฑ.trim());
        });

        ุงููุชูุฌุฉ.ุงููููุงุช = ูููุงุช.join('\n\n');
        ุงููุชูุฌุฉ.ุงูุนููุงู = ุจูุงูุงุช.shift();
        ุงููุชูุฌุฉ.ุงููุบูู = ุจูุงูุงุช.shift();
        ุงููุชูุฌุฉ.ุงูููุตุงุช = ุจูุงูุงุช.filter(_ => !_.includes(':'));

        ุจูุงูุงุช.forEach(ุจูุงู => {
            if (ุจูุงู.includes(':')) {
                const [ุงูุงุณู, ุงููููุฉ] = ุจูุงู.split(':');
                ุงููุชูุฌุฉ[ุงูุงุณู.toLowerCase()] = ุงููููุฉ.trim();
            }
        });

        return ุงููุชูุฌุฉ;
    } catch (error) {
        return { ุฎุทุฃ: error.message };
    }
}

const ูุนุงูุฌ = async (m, { text, usedPrefix, command }) => {
    if (!text) {
        let ุฑุณุงูุฉ_ุชูุถูุญูุฉ = `๐ง *ููููุฉ ุงุณุชุฎุฏุงู ุงูุฃูุฑ ${command}:*\n\n` +
            `๐น *ุงููุตู:* ูุฐุง ุงูุฃูุฑ ูุจุญุซ ุนู ูููุงุช ุงูุฃุบุงูู ุนุจุฑ ุงูุฅูุชุฑูุช.\n` +
            `๐ *ุงูุงุณุชุฎุฏุงู:* \n` +
            `โฆ ${usedPrefix + command} [ุงุณู ุงูุฃุบููุฉ]\n\n` +
            `๐ญ *ุฃูุซูุฉ:*\n` +
            `โฆ ${usedPrefix + command} someone like you\n` +
            `โฆ ${usedPrefix + command} ุจููุง ุชุดุงู\n\n` +
            `๐ *ููุงุญุธุฉ:* ุชุฃูุฏ ูู ูุชุงุจุฉ ุงุณู ุงูุฃุบููุฉ ุจุดูู ุตุญูุญ.\n\n` +
            `๐๐ธ๐๐พ ๐ฑ๐พ๐๐ง`;

        return m.reply(ุฑุณุงูุฉ_ุชูุถูุญูุฉ);
    }

    m.reply('๐ง *ุฌุงุฑู ุงูุจุญุซ ุนู ูููุงุช ุงูุฃุบููุฉ...*');

    try {
        const ุงููุชูุฌุฉ = await ุฌูุจ_ูููุงุช(text);

        if (!ุงููุชูุฌุฉ.ุงููููุงุช) return m.reply('๐ง *ูู ูุชู ุงูุนุซูุฑ ุนูู ูููุงุช ุงูุฃุบููุฉ! ุญุงูู ูุฑุฉ ุฃุฎุฑู ุจุนููุงู ูุฎุชูู.*');

        let ุฑุฏ = `๐ต *ุนููุงู ุงูุฃุบููุฉ:* ${ุงููุชูุฌุฉ.ุงูุนููุงู || 'ุบูุฑ ูุนุฑูู'} ๐ต\n`;
        ุฑุฏ += ุงููุชูุฌุฉ.ุงููุบูู ? `๐ค *ุงููุบูู:* ${ุงููุชูุฌุฉ.ุงููุบูู}\n\n` : '\n';
        ุฑุฏ += `๐ *ูููุงุช ุงูุฃุบููุฉ:*\n${ุงููุชูุฌุฉ.ุงููููุงุช}\n\n`;
        ุฑุฏ += `๐๐ธ๐๐พ ๐ฑ๐พ๐๐ง`;

        m.reply(ุฑุฏ);
    } catch (error) {
        console.error(error);
        m.reply('๐ง *ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุจุญุซ ุนู ูููุงุช ุงูุฃุบููุฉ! ุญุงูู ูุฑุฉ ุฃุฎุฑู ูุงุญููุง.*');
    }
};

// ๐ง **ุฅุถุงูุฉ ุงูุฃูุงูุฑ ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ**
ูุนุงูุฌ.help = ['ูููุงุช', 'lirik', 'lyrics', 'searchlirik'];
ูุนุงูุฌ.tags = ['music', 'ููุณููู'];
ูุนุงูุฌ.command = /^(ูููุงุช|lirik|lyrics|searchlirik)$/i;

export default ูุนุงูุฌ;